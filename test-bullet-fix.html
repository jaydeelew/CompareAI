<!DOCTYPE html>
<html>
<head>
    <title>Bullet Point Test</title>
</head>
<body>
    <h1>Testing markdown list parsing</h1>
    
    <h2>Raw Input:</h2>
    <pre>
- d/dx(x³) = 3x²
- d/dx(-x²) = -2x
- d/dx(1) = 0
    </pre>
    
    <h2>Step-by-step processing:</h2>
    <div id="output"></div>
    
    <script>
        let text = `- d/dx(x³) = 3x²
- d/dx(-x²) = -2x
- d/dx(1) = 0`;

        let output = document.getElementById('output');
        
        // Step 1: Convert to placeholders
        let step1 = text.replace(/^(\s*)- (?!\[[ x]\])(.+)$/gm, (match, indent, content) => {
            const indentLevel = indent.length;
            return `___UL_ITEM___${indentLevel}___${content}___/UL_ITEM___`;
        });
        
        output.innerHTML += `<h3>Step 1 - Convert to placeholders:</h3><pre>${step1}</pre>`;
        
        // Step 2: Protect list boundaries
        let step2 = step1.replace(/(___(?:UL|OL|TASK)_ITEM___[^\n]*___\/(?:UL|OL|TASK)_ITEM___)\n+(___(?:UL|OL|TASK)_ITEM___)/g, '$1___LISTBREAK___$2');
        
        output.innerHTML += `<h3>Step 2 - Protect boundaries:</h3><pre>${step2}</pre>`;
        
        // Step 3: Apply paragraph breaks (none in this case since no \n\n)
        let step3 = step2.replace(/\n\n/g, '</p><p>');
        
        output.innerHTML += `<h3>Step 3 - Apply paragraph breaks:</h3><pre>${step3}</pre>`;
        
        // Step 4: Restore list separators
        let step4 = step3.replace(/___LISTBREAK___/g, '\n');
        
        output.innerHTML += `<h3>Step 4 - Restore separators:</h3><pre>${step4}</pre>`;
        
        // Step 5: Convert to HTML
        let step5 = step4.replace(/(___UL_ITEM___[\s\S]*?___\/UL_ITEM___(?:\s*___UL_ITEM___[\s\S]*?___\/UL_ITEM___)*)/g, (match) => {
            const items = [];
            match.replace(/___UL_ITEM___(\d+)___(.*?)___\/UL_ITEM___/g, (_, indentLevel, content) => {
                items.push({
                    level: parseInt(indentLevel),
                    content: content.trim()
                });
                return '';
            });

            if (items.length === 0) return match;

            let html = '<ul>';
            items.forEach(item => {
                html += `<li>${item.content}</li>`;
            });
            html += '</ul>';
            return html;
        });
        
        output.innerHTML += `<h3>Step 5 - Convert to HTML:</h3><pre>${step5.replace(/</g, '&lt;').replace(/>/g, '&gt;')}</pre>`;
        output.innerHTML += `<h3>Final rendered:</h3>${step5}`;
    </script>
</body>
</html>

